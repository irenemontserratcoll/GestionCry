<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n Cry</title>
    <link rel="stylesheet" th:href="@{/stylesAdmin.css}">
</head>
<body>
    <div class="admin-container">

        <!-- MENSAJES EXITO Y ERROR -->
        <div th:if="${success}" class="success-message">
            <p th:text="${success}"></p>
        </div>
        <div th:if="${error}" class="error-message">
            <p th:text="${error}"></p>
        </div>

        <!-- TITULO -->
        <img th:src="@{/logo.jpeg}" alt="Logo" class="logo">
        <h2>Administraci√≥n Cry</h2>

       <!-- MENU HORIZONTAL --> 
        <div class="tab-menu">
            <button class="tab active" onclick="showTab('usuarios')">Usuarios</button>
            <button class="tab" onclick="showTab('libros')">Libros</button>
            <button class="tab" onclick="showTab('ordenadores')">Ordenadores</button>
            <button class="tab" onclick="showTab('espacios-individuales')">Espacios Individuales</button>
            <button class="tab" onclick="showTab('espacios-grupales')">Espacios Grupales</button>
            <button class="tab" onclick="showTab('reservas')">Reservas</button>
        </div>

        <!-- SECCION USUARIOS -->
        <div id="usuarios" class="tab-content active">
            <div class="search-form">
                <input type="text" id="searchInput" placeholder="üîç Buscar por correo" onkeyup="filterTable()">
            </div>
            <div class="table-wrapper">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Correo</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                </table>
            
                <div class="table-scroll">
                    <table class="styled-table">
                        <tbody>
                            <tr th:each="usuario, iterStat : ${usuarios}">
                                <td th:text="${iterStat.count}"></td>
                                <td th:text="${usuario.nombre}"></td>
                                <td th:text="${usuario.correo}"></td>
                                <td>
                                    <form action="/delete-user" method="post">
                                        <input type="hidden" name="correo" th:value="${usuario.correo}" />
                                        <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!--A√±adir nuevo usuario-->
            <div class="user-form">
                <form action="/add-user" method="post">
                    <input type="text" placeholder="Nombre" name="nombre" required>
                    <input type="email" placeholder="Correo" name="correo" required>
                    <input type="password" placeholder="Contrase√±a" name="password" required>
                    <button type="submit" class="btn-add">A√±adir Usuario</button>
                </form>
            </div>

        </div>
        
        <!-- SECCION LIBROS -->
        <div id="libros" class="tab-content">
            <!-- Barra de b√∫squeda de Libros -->
            <div class="search-form">
                <input type="text" id="searchLibros" placeholder="üîç Buscar por t√≠tulo, autor o ISBN" onkeyup="filterLibros()">
        </div>
            <!-- tabla de libros -->
            <div class="table-wrapper">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>T√≠tulo</th>
                            <th>Autor</th>
                            <th>ISBN</th>
                            <th>Actualizar</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                </table>

                <div class="table-scroll">
                    <table class="styled-table">
                        <tbody>
                            <tr th:each="libro, iterStat : ${libros}">
                                <td th:text="${iterStat.count}"></td>
                                <td th:text="${libro.titulo}"></td>
                                <td th:text="${libro.autor}"></td>
                                <td th:text="${libro.isbn}"></td>
                                <!-- Formulario para actualizar libro -->
                                <td>
                                    <form action="/update-libro" method="post">
                                        <input type="hidden" name="isbn" th:value="${libro.isbn}" />
                                        <input type="text" name="titulo" placeholder="T√≠tulo" th:value="${libro.titulo}" required>
                                        <input type="text" name="autor" placeholder="Autor" th:value="${libro.autor}" required>
                                        <button type="submit" class="btn-update">‚úèÔ∏è</button>
                                    </form>
                                </td>
                                <!-- Bot√≥n eliminar libro -->
                                <td>
                                    <form action="/delete-libro" method="post">
                                        <input type="hidden" name="isbn" th:value="${libro.isbn}" />
                                        <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- A√±adir nuevo libro -->
            <div class="user-form">
                <form action="/add-libro" method="post">
                    <input type="text" placeholder="T√≠tulo" name="titulo" required>
                    <input type="text" placeholder="Autor" name="autor" required>
                    <input type="text" placeholder="ISBN" name="isbn" required>
                    <button type="submit" class="btn-add">A√±adir Libro</button>
                </form>
            </div>
        </div>

        <!-- SECCION ORDENADORES -->
        <div id="ordenadores" class="tab-content">
            <!-- Barra de b√∫squeda -->
            <div class="search-form">
                <input type="text" id="searchComputers" placeholder="üîç Buscar por marca, modelo o n√∫mero de serie" onkeyup="filterComputers()">
            </div>

            <!-- Tabla de ordenadores -->
            <div class="table-wrapper">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Marca</th>
                            <th>Modelo</th>
                            <th>N√∫mero de Serie</th>
                            <th>Disponible</th>
                            <th>Actualizar</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                </table>

                <div class="table-scroll">
                    <table class="styled-table">
                        <tbody>
                            <tr th:each="ordenador, iterStat : ${ordenadores}">
                                <td th:text="${iterStat.count}"></td>
                                <td th:text="${ordenador.marca}"></td>
                                <td th:text="${ordenador.modelo}"></td>
                                <td th:text="${ordenador.numeroSerie}"></td>
                                <td th:text="${ordenador.disponible ? 'S√≠' : 'No'}"></td>
                                <!-- Formulario para actualizar -->
                                <td>
                                    <form action="/update-ordenador" method="post">
                                        <input type="hidden" name="numeroSerie" th:value="${ordenador.numeroSerie}" />
                                        <input type="text" name="marca" placeholder="Marca" th:value="${ordenador.marca}" required>
                                        <input type="text" name="modelo" placeholder="Modelo" th:value="${ordenador.modelo}" required>
                                        <select name="disponible">
                                            <option value="true" th:selected="${ordenador.disponible}">S√≠</option>
                                            <option value="false" th:selected="${!ordenador.disponible}">No</option>
                                        </select>
                                        <button type="submit" class="btn-update">‚úèÔ∏è</button>
                                    </form>
                                </td>
                                <!-- Bot√≥n eliminar -->
                                <td>
                                    <form action="/delete-ordenador" method="post">
                                        <input type="hidden" name="numeroSerie" th:value="${ordenador.numeroSerie}" />
                                        <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- A√±adir nuevo ordenador -->
            <div class="user-form">
                <form action="/add-ordenador" method="post">
                    <input type="text" placeholder="Marca" name="marca" required>
                    <input type="text" placeholder="Modelo" name="modelo" required>
                    <input type="text" placeholder="N√∫mero de Serie" name="numeroSerie" required>
                    <select name="disponible" required>
                        <option value="true">Disponible</option>
                        <option value="false">No disponible</option>
                    </select>
                    <button type="submit" class="btn-add">A√±adir Ordenador</button>
                </form>
            </div>
        </div>

        <!-- SECCION ESPACIO INDIVIDUAL -->
        <div id="espacios-individuales" class="tab-content">
            <!-- Barra de b√∫squeda -->
            <div class="search-form">
                <input type="text" id="searchEspacios" placeholder="üîç Buscar por piso o n√∫mero de asiento" onkeyup="filterEspacios()">
        </div>
            <!-- tabla de espacios individuales -->
            <div class="table-wrapper">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Piso</th>
                            <th>N√∫mero de Asiento</th>
                            <th>Actualizar</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                </table>

                <div class="table-scroll">
                    <table class="styled-table">
                        <tbody>
                            <tr th:each="espacio, iterStat : ${espaciosIndividuales}">
                                <td th:text="${iterStat.count}"></td>
                                <td th:text="${espacio.piso}"></td>
                                <td th:text="${espacio.numeroAsiento}"></td>
                                <!-- Formulario para actualizar espacio -->
                                <td>
                                    <form action="/update-espacio" method="post">
                                        <input type="hidden" name="piso" th:value="${espacio.piso}" />
                                        <input type="hidden" name="numeroAsiento" th:value="${espacio.numeroAsiento}" />
                                        <button type="submit" class="btn-update">‚úèÔ∏è</button>
                                    </form>
                                </td>
                                <!-- Bot√≥n eliminar espacio Individual -->
                                <td>
                                    <form action="/delete-espacio" method="post">
                                        <input type="hidden" name="piso" th:value="${espacio.piso}" />
                                        <input type="hidden" name="numeroAsiento" th:value="${espacio.numeroAsiento}" />
                                        <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- A√±adir nuevo espacio individual -->
            <div class="user-form">
                <form action="/add-espacio" method="post">
                    <input type="number" placeholder="Piso" name="piso" required>
                    <input type="number" placeholder="N√∫mero de Asiento" name="numeroAsiento" required>
                    <button type="submit" class="btn-add">A√±adir Espacio</button>
                </form>
            </div>
        </div>
        
        <!-- SECCION ESPACIO GRUPAL -->
        <div id="espacios-grupales" class="tab-content">
            
            <!-- Barra de b√∫squeda -->
            <div class="search-form">
                <input type="text" id="searchSalas" placeholder="üîç Buscar por piso o n√∫mero de sala" onkeyup="filterSalas()">
            </div>

            <!-- Tabla de salas grupales -->
            <div class="table-wrapper">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Piso</th>
                            <th>N√∫mero de Sala</th>
                            <th>Capacidad</th>
                            <th>Actualizar</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                </table>

                <div class="table-scroll">
                    <table class="styled-table">
                        <tbody>
                            <tr th:each="sala, iterStat : ${salasGrupales}" th:id="'sala-row-' + ${iterStat.index}">
                                <td th:text="${iterStat.count}"></td>
                                <td th:text="${sala.piso}"></td>
                                <td th:text="${sala.numeroSala}"></td>
                                <span th:text="${sala.numeroPersonas}"></span>
                                <!-- Formulario para actualizar sala -->
                                <td>
                                    <form action="/update-sala" method="post">
                                        <input type="hidden" name="piso" th:value="${sala.piso}" />
                                        <input type="hidden" name="numeroSala" th:value="${sala.numeroSala}" />
                                        <input type="number" name="capacidad" placeholder="Capacidad" th:value="${sala.numeroPersonas}" required>
                                        <button type="submit" class="btn-update">‚úèÔ∏è</button>
                                    </form>
                                </td>
                                <!-- Bot√≥n eliminar sala -->
                                <td>
                                    <form action="/delete-sala" method="post">
                                        <input type="hidden" name="piso" th:value="${sala.piso}" />
                                        <input type="hidden" name="numeroSala" th:value="${sala.numeroSala}" />
                                        <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- A√±adir nueva sala grupal -->
            <div class="user-form">
                <form action="/add-sala" method="post">
                    <input type="number" placeholder="Piso" name="piso" required>
                    <input type="number" placeholder="N√∫mero de Sala" name="numeroSala" required>
                    <input type="number" placeholder="Capacidad" name="capacidad" required>
                    <button type="submit" class="btn-add">A√±adir Sala</button>
                </form>
            </div>
        </div>
        
        <!-- SECCION RESERVAS -->
        <div id="reservas" class="tab-content">
            <div class="table-wrapper">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Correo</th>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Personas</th>
                            <th>Libro</th>
                            <th>Ordenador</th>
                            <th>Sala Grupal</th>
                            <th>Espacio Individual</th>
                        </tr>
                    </thead>
                </table>

                <div class="table-scroll">
                    <table class="styled-table">
                        <tbody>
                            <tr th:each="reserva, iterStat : ${reservas}">
                                <td th:text="${iterStat.count}"></td>
                                <td th:text="${reserva.nombreCliente}"></td>
                                <td th:text="${reserva.emailCliente}"></td>
                                <td th:text="${reserva.fechaReserva}"></td>
                                <td th:text="${reserva.horaReserva}"></td>
                                <td th:text="${reserva.numPersonas}"></td>
                                <td th:text="${reserva.libro != null ? reserva.libro.titulo : '-'}"></td>
                                <td th:text="${reserva.ordenador != null ? reserva.ordenador.modelo : '-'}"></td>
                                <td th:text="${reserva.salaGrupal != null ? reserva.salaGrupal.numeroSala : '-'}"></td>
                                <td th:text="${reserva.espacioIndividual != null ? reserva.espacioIndividual.numeroAsiento : '-'}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- A√±adir nueva reserva -->
            <div class="user-form">
                <h3>A√±adir nueva reserva</h3>
                <form action="/add-reserva" method="post">
                    <input type="text" name="nombreCliente" placeholder="Nombre cliente" required>
                    <input type="email" name="emailCliente" placeholder="Correo cliente" required>
                    <input type="date" name="fechaReserva" required>
                    <input type="time" name="horaReserva" required>
                    <input type="number" name="numPersonas" placeholder="N√∫mero de personas" min="1" required>

                    <!-- Campos opcionales -->
                    <input type="number" name="libroId" placeholder="ID Libro (opcional)">
                    <input type="number" name="ordenadorId" placeholder="ID Ordenador (opcional)">
                    <input type="number" name="salaGrupalId" placeholder="ID Sala Grupal (opcional)">
                    <input type="number" name="espacioIndividualId" placeholder="ID Espacio Individual (opcional)">

                    <button type="submit" class="btn-add">A√±adir Reserva</button>
                </form>
            </div>
        </div>


    <!-- FUNCIONES DE  LA PLANTILLA --> 
    <script>
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
    
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toLowerCase();
            const table = document.querySelector(".table-scroll table tbody");
            const rows = table.getElementsByTagName("tr");

            for (let i = 0; i < rows.length; i++) {
                const correoCell = rows[i].getElementsByTagName("td")[2];
                if (correoCell) {
                    const correo = correoCell.textContent || correoCell.innerText;
                    if (correo.toLowerCase().indexOf(filter) > -1) {
                        rows[i].style.display = "";
                    } else {
                        rows[i].style.display = "none";
                    }
                }
            }
        }
    </script>
</body>
</html>
