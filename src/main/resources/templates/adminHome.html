<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n Cry</title>
    <link rel="stylesheet" th:href="@{/stylesAdmin.css}">
</head>
<body>
    <div class="admin-container">

        <!-- MENSAJES EXITO Y ERROR -->
        <div th:if="${success}" class="success-message">
            <p th:text="${success}"></p>
        </div>
        <div th:if="${error}" class="error-message">
            <p th:text="${error}"></p>
        </div>

        <!-- TITULO -->
        <img th:src="@{/logo.jpeg}" alt="Logo" class="logo">
        <h2>Administraci√≥n Cry</h2>

       <!-- MENU HORIZONTAL --> 
        <div class="tab-menu">
            <button class="tab active" onclick="showTab('usuarios')">Usuarios</button>
            <button class="tab" onclick="showTab('libros')">Libros</button>
            <button class="tab" onclick="showTab('ordenadores')">Ordenadores</button>
            <button class="tab" onclick="showTab('espacios-individuales')">Espacios Individuales</button>
            <button class="tab" onclick="showTab('espacios-grupales')">Espacios Grupales</button>
            <button class="tab" onclick="showTab('reservas')">Reservas</button>
        </div>

        <!-- SECCION USUARIOS -->
        <div id="usuarios" class="tab-content active">
            <div class="search-form">
                <input type="text" id="searchInput" placeholder="üîç Buscar por correo" onkeyup="filterTable()">
            </div>
            <div class="table-wrapper">
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Correo</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                </table>
            
                <div class="table-scroll">
                    <table class="styled-table">
                        <tbody>
                            <tr th:each="usuario, iterStat : ${usuarios}">
                                <td th:text="${iterStat.count}"></td>
                                <td th:text="${usuario.nombre}"></td>
                                <td th:text="${usuario.correo}"></td>
                                <td>
                                    <form action="/delete-user" method="post">
                                        <input type="hidden" name="correo" th:value="${usuario.correo}" />
                                        <button type="submit" class="btn-delete">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!--A√±adir nuevo usuario-->
            <div class="user-form">
                <form action="/add-user" method="post">
                    <input type="text" placeholder="Nombre" name="nombre" required>
                    <input type="email" placeholder="Correo" name="correo" required>
                    <input type="password" placeholder="Contrase√±a" name="password" required>
                    <button type="submit" class="btn-add">A√±adir Usuario</button>
                </form>
            </div>

        </div>
        
        <!-- SECCION LIBROS -->
        <div id="libros" class="tab-content">
            <!-- tabla de libros -->
        </div>
        
        <!-- SECCION ORDENADORES -->
        <div id="ordenadores" class="tab-content">
            <!-- tabla de ordenadores -->
        </div>

        <!-- SECCION ESPACIO INDIVIDUAL -->
        <div id="espacios-individuales" class="tab-content">
            <!-- tabla de espacios individuales -->
        </div>
        <!-- SECCION ESPACIO GRUPAL -->
        <div id="espacios-grupales" class="tab-content">
            <!-- tabla de espacios grupales -->
        </div>
        <!-- SECCION RESERVAS -->
<div id="reservas" class="tab-content">
    <div class="table-wrapper">
        <table class="styled-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Nombre</th>
                    <th>Correo</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Personas</th>
                    <th>Libro</th>
                    <th>Ordenador</th>
                    <th>Sala Grupal</th>
                    <th>Espacio Individual</th>
                </tr>
            </thead>
        </table>

        <div class="table-scroll">
            <table class="styled-table">
                <tbody>
                    <tr th:each="reserva, iterStat : ${reservas}">
                        <td th:text="${iterStat.count}"></td>
                        <td th:text="${reserva.nombreCliente}"></td>
                        <td th:text="${reserva.emailCliente}"></td>
                        <td th:text="${reserva.fechaReserva}"></td>
                        <td th:text="${reserva.horaReserva}"></td>
                        <td th:text="${reserva.numPersonas}"></td>
                        <td th:text="${reserva.libro != null ? reserva.libro.titulo : '-'}"></td>
                        <td th:text="${reserva.ordenador != null ? reserva.ordenador.modelo : '-'}"></td>
                        <td th:text="${reserva.salaGrupal != null ? reserva.salaGrupal.numeroSala : '-'}"></td>
                        <td th:text="${reserva.espacioIndividual != null ? reserva.espacioIndividual.numeroAsiento : '-'}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- FORMULARIO PARA A√ëADIR NUEVA RESERVA -->
    <div class="user-form">
        <h3>A√±adir nueva reserva</h3>
        <form action="/add-reserva" method="post">
            <input type="text" name="nombreCliente" placeholder="Nombre cliente" required>
            <input type="email" name="emailCliente" placeholder="Correo cliente" required>
            <input type="date" name="fechaReserva" required>
            <input type="time" name="horaReserva" required>
            <input type="number" name="numPersonas" placeholder="N√∫mero de personas" min="1" required>

            <!-- Campos opcionales -->
            <input type="number" name="libroId" placeholder="ID Libro (opcional)">
            <input type="number" name="ordenadorId" placeholder="ID Ordenador (opcional)">
            <input type="number" name="salaGrupalId" placeholder="ID Sala Grupal (opcional)">
            <input type="number" name="espacioIndividualId" placeholder="ID Espacio Individual (opcional)">

            <button type="submit" class="btn-add">A√±adir Reserva</button>
        </form>
    </div>
</div>


    <!-- FUNCIONES DE  LA PLANTILLA --> 
    <script>
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
    
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function filterTable() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toLowerCase();
            const table = document.querySelector(".table-scroll table tbody");
            const rows = table.getElementsByTagName("tr");

            for (let i = 0; i < rows.length; i++) {
                const correoCell = rows[i].getElementsByTagName("td")[2];
                if (correoCell) {
                    const correo = correoCell.textContent || correoCell.innerText;
                    if (correo.toLowerCase().indexOf(filter) > -1) {
                        rows[i].style.display = "";
                    } else {
                        rows[i].style.display = "none";
                    }
                }
            }
        }
    </script>
</body>
</html>
